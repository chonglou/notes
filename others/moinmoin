1. 安装

安装到 /opt/www/moin目录下
1.1. 系统依赖

安装

apt-get install python2.7 virtualenv uwsgi uwsgi-plugin-python

1.2. python

创建python安全沙盒

mkdir -p /opt/www/moin
virtualenv /opt/www/moin/python2
source /opt/www/moin/python2/bin/activate

1.3. moin

安装moin

# 下载
cd /tmp
wget http://static.moinmo.in/files/moin-1.9.7.tar.gz
tar zxvf moin-1.9.7.tar.gz
cd moin-1.9.7
# 安装
python setup.py install

# 清除python环境变量
deactivate

# 复制静态资源文件
cp -r ./wiki /opt/www/moin/

# 复制配置文件
cd /opt/www/moin/wiki/
cp config/wikiconfig.py ./
cp server/moin.wsgi ./

1.4. uwsgi

wsgi配置(vi /opt/www/moin/wiki/moin.wsgi)

sys.path.insert(0, '/opt/www/moin/python2/lib/python2.7/site-packages/')
sys.path.insert(0, '/opt/www/moin/wiki/')

设置文件权限

chown www-data:www-data -R /opt/www/moin
chmod o-rwx -R /opt/www/moin

uwsgi配置(vi /opt/www/moin/wiki/uwsgi.xml)

<uwsgi>
    <uid>www-data</uid>
    <gid>www-data</gid>
    <plugin>python</plugin>
    <socket>/opt/www/moin/moin.sock</socket>
    <wsgi-file>/opt/www/moin/wiki/moin.wsgi</wsgi-file>
    <limit-as>256</limit-as>
    <processes>8</processes>
    <logto>/var/log/uwsgi/uwsgi.log</logto>
    <memory-report/>
    <vhost/>
    <no-site/>
</uwsgi>

启动

exec uwsgi -x /opt/www/moin/wiki/uwsgi.xml &

1.5. nginx

server {
    server_name 你的域名;

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    location ^~ /moin_static193/ {
            alias /opt/www/moin/python2/lib/python2.7/site-packages/MoinMoin/web/static/htdocs/;
            add_header Cache-Control public;
            expires 1M;
    }

    location / {
        include uwsgi_params;
        uwsgi_pass unix:///opt/www/moin/moin.sock;
        uwsgi_modifier1 30;
    }
}

2. 编辑技巧

2.1. 显示目录

<<TableOfContents(3)>>

2.2. 图片内嵌展示

{{attachment:graphics.png}}

2.3. robots.txt和favicon.ico

nginx配置文件中增加(文件放/opt/www/moin/wiki/htdocs下)

    location ^~ /robots.txt {
            alias /opt/www/moin/wiki/htdocs/robots.txt;
    }
    location ^~ /favicon.ico {
            alias /opt/www/moin/wiki/htdocs/favicon.ico;
    }

2.4. 显示章节号

配置文件中增加

 show_section_numbers = 1

2.5. 包含页面

<<Include(SomePage)>>

2.6. 编辑中隐藏

#acl All: 

2.7. 允许公开评论的页面

#acl All:read,write 

3. 其它

3.1. Google 网站验证

修改wikiconfig.py文件，添加

html_head = '<meta name="google-site-verification" content="替换成你的" />'

3.2. sitemap.xml

Sitemap 可方便网站管理员通知搜索引擎他们网站上有哪些可供抓取的网页。Moin对此的支持是非常简单的，只需要在任何页面链接（最好是主页）之后加上?action=sitemap即可
3.3. 扩展模板

修改配置文件

page_header1=u''
page_header2=u''
page_footer1=u''
page_footer2=u''
